<html>
<head>
    <script src="jquery/jquery.min.js" type="text/javascript"></script>
    <script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

    <script src="js/main.js" type="text/javascript"></script>
    <script src="AudioContext-MonkeyPatch/AudioContextMonkeyPatch.js" type="text/javascript"></script>



    <link  href="rainbow/themes/github.css" rel="stylesheet" type="text/css"/>
    <link  href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>

    <link  href="css/main.css" rel="stylesheet" type="text/css"/>

</head>
<body>
    <style>

    </style>
  <script type="text/javascript">

    // // // create context
    // // var context  = new webkitAudioContext();


    // // var createChannel = function(source){
    // //     var channel = {};
    // //     // create source
    // //     channel.source         = context.createMediaElementSource(source);
    // //     channel.destination    = context.destination;
    // //     channel.gainNode       = context.createGainNode();
    // //     channel.gainNode.gain = 0;
    // //     // channel.analyser       = context.createAnalyser();
    // //     // channel.analyser.fftSize = 2048;
    // //     // connect
    // //     channel.source.connect(channel.gainNode);
    // //     channel.gainNode.connect(channel.destination);
    // //     return channel;
    // // }

    // // var audioElement = new Audio();
    // // audioElement.addEventListener("canplaythrough", function() {
    // //   var channel = createChannel(audioElement);
    //   $('.play').on('click', function(){
    //     playSound()
    //     $('body').addClass('playing');
    //   });
    //   $('.pause').on('click', function(){
    //     stopSound()
    //     $('body').removeClass('playing');
    //   });
    // // });
    // // audioElement.src = 'papa_roach_last_resort.mp3';

    $(function(){
      var context = new window.AudioContext();
      var buffer;
      var channel = {};

      window.stopButtonClick = function(index){
          channel.source.stop(0);
      }

      window.playButtonClick = function(index){
          channel.source         = context.createBufferSource();
          channel.source.buffer  = buffer;

          channel.destination    = context.destination;

          channel.gainNode       = context.createGain();
          channel.gainNode.gain.value  = $('.range1').val();

          channel.source.connect(channel.gainNode);
          channel.gainNode.connect(channel.destination);

          channel.source.start(0);
      }

      var initSound = function(arrayBuffer) {
        context.decodeAudioData(arrayBuffer, function(decodedArrayBuffer) {
          buffer = decodedArrayBuffer;
          $('body').addClass('readytoplay');
        }, function(e) {
          console.log('Error decoding file', e);
        });
      }

      var loadSoundFile = function(url) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'arraybuffer';
        xhr.onload = function(e) {
          initSound(this.response); // this.response is an ArrayBuffer.
        };
        xhr.send();
      }

      loadSoundFile('papa_roach_last_resort.mp3');

      $('.range1').on('change', function(e){
        if(!channel.gainNode) return;
        channel.gainNode.gain.value = $('.range1').val();
      });
    });

  </script>
  <h2>Gain node</h2>
<pre data-language="javascript">
  var gainNode = context.createGainNode();
  gainNode.gain.value  = 0.4;  // 0..1

  source.connect(gainNode);
  gainNode.connect(destination);
</pre>

  <div class="scheme" style="background-image:url(source-gain-destination.svg)"></div>
  <div class="legend">
    <!-- <h3>Gain</h3> -->
    <ul>
      <li><label>Gain level</label><input class="range1" type="range" name="points" step="0.05" min="0.1" max="1" value="0.2"></li>
    </ul>
  </div>

  <button type="button" class="play  btn btn-primary">Play</button>
  <button type="button" class="pause btn btn-success">Pause</button>

    <script src="rainbow/rainbow.min.js" type="text/javascript"></script>
    <script src="rainbow/language/generic.js" type="text/javascript"></script>
    <script src="rainbow/language/javascript.js" type="text/javascript"></script>


</body>
</html>